{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.min.js","sourcesContent":["/**\n * by lcs@lcs.io\n * 2017-07-16\n */\n\n(function(){\n    'use strict';\n    const album = window.album || 'B0Z5qXGF1iS2iW';\n    const audio = $('audio')[0];\n\n    fetch(`/album/${album}`,{method:'POST'}).then(req=>req.json()).then(data=>{\n        const host = (function(locations){\n            for( let host in locations ){\n                return `${locations[host].scheme}://${locations[host].hosts[0]}`\n            }\n        })(data.webasseturls.locations);\n\n        showTitle(data.webstream.photos.map(photo=>photo.dateCreated.match(/\\d{4}-\\d\\d-\\d\\d/)[0]).sort())\n        return {\n            host:host,\n            photos:data.webstream.photos\n                .map(photo=>photo['derivatives']['2049']['checksum'])\n                .map(checksum=>data.webasseturls.items[checksum])\n        };\n    }).then(data=>{\n        const photos = data.photos.map( item=>`${data.host}${item.url_path}` );\n\n        if( !audio )return carousel(photos);\n        if( !audio.play )return carousel(photos);\n\n        const $playButton = $('.play-button').removeClass('hide');\n        let canPlay = true;\n\n        $('img.in').prop('src',photos[0]);\n\n        $playButton.on('click',function(){\n            if(!canPlay)return;\n            clearInterval(timeId);\n            if(audio.paused){\n                audio.play().catch(()=>{canPlay=false;});\n                carousel(photos);\n                $playButton.removeClass('in');\n            }else{\n                audio.pause();\n                $playButton.addClass('in');\n            }\n        });\n\n    });\n\n    const showTitle = function(dateList){\n        let $title = $('.title').html( `${dateList[0]}_${dateList[dateList.length-1]}`);\n        setTimeout(function() {\n            $title.fadeOut();\n        }, 5000);\n    };\n\n    let timeId = 0;\n    let index = 0;\n    const carousel = function( photos ){\n        //photos = photos.filter((a,i)=>i<3);\n        \n        let speed = 3 * 1000;\n        let $img = $('img.photo');\n        let $pre = $('img.preload');\n        $img.filter('.in').prop('src',photos[index]);\n        index = (index+1) % photos.length;\n        $img.filter(':not(.in)').prop('src',photos[index]);\n        timeId = setInterval(()=>{\n            $img.filter(':not(.in)').prop('src',$pre.prop('src'));\n            $img.toggleClass('in');\n            index = (index+1) % photos.length;\n            $pre.prop('src',photos[index]);\n        },speed);\n    };\n\n\n\n})();\n\n"]}